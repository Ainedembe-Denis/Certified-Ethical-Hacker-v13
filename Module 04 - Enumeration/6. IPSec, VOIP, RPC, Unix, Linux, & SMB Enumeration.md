# üì° 6. IPsec, VoIP, RPC, Unix, Linux, & SMB Enumeration
### CEH v13 ¬∑ Module 04: Enumeration

> **About these notes:** This guide provides exhaustive coverage of IPSec VPNs, VoIP (SIP) infrastructure, RPC endpoints, Unix/Linux user sessions, and SMB shares. These protocols represent the backbone of enterprise communication and are prime targets for enumeration.

---

## üìë Table of Contents

1. [IPsec Enumeration](#1-ipsec-enumeration)
   - [IKE & ISAKMP (Port 500)](#-ike--isakmp-port-500)
   - [ike-scan Fingerprinting](#-ike-scan-fingerprinting)
2. [VoIP Enumeration (SIP)](#2-voip-enumeration-sip)
3. [RPC Enumeration](#3-rpc-enumeration)
4. [Unix/Linux User Enumeration](#4-unixlinux-user-enumeration)
   - [Flag Tables: rusers, rwho, finger](#-flag-tables-rusers-rwho-finger)
5. [SMB Enumeration](#5-smb-enumeration)
6. [Creating & Running Custom AI Automation Scripts](#6-creating--running-custom-ai-automation-scripts)
7. [CEH Exam Traps & Tips](#7-ceh-exam-traps--tips)

---

## 1. IPsec Enumeration

IPsec (Internet Protocol Security) is the standard for VPN security, using **ESP (Encapsulating Security Payload)**, **AH (Authentication Header)**, and **IKE (Internet Key Exchange)**.

### üõ°Ô∏è ISAKMP (UDP Port 500)
Most IPsec VPNs use **ISAKMP** (part of IKE) to manage Security Associations (SA).
- **Discovery Scan:** `nmap ‚ÄìsU ‚Äìp 500 <Target_IP>`
- **AI Prompt:** *"Perform IPsec enumeration on target IP 10.10.1.22 with nmap"*
- **Detailed Command:** `nmap -sU -p 500 ‚Äìscript=ike-version 10.10.1.22`

### üõ†Ô∏è ike-scan Tool
**Source:** [github.com](https://github.com)
Fingerprints hosts using the **retransmission backoff pattern**.
- **Discovery:** Identifies hosts responding to IKE requests.
- **Fingerprinting:** 
  - **UDP backoff:** Compares retransmission patterns.
  - **Vendor ID:** Compares Vendor ID payloads against known patterns.
- **Transform Enumeration:** Identifies supported encryption/hash algorithms (Phase 1).
- **User Enumeration:** Discovers valid VPN usernames on certain systems.
- **PSK Cracking:** Obtains hashes for offline cracking with `psk-crack`.

---

## 2. VoIP Enumeration (SIP)

VoIP replaces PSTN by transmitting voice over IP networks. **Session Initiation Protocol (SIP)** is the primary signaling protocol.
- **Standard Ports:** UDP/TCP **2000, 2001, 5060, 5061**.

### üõ†Ô∏è VoIP Tools & Capabilities
*   **Svmap:** [github.com](https://github.com)
    -   Scans default and non-default ports.
    -   Can identify SIP devices and PBX servers across large IP ranges.
    -   Function: Ring all phones on a network simultaneously using the `INVITE` method.
    -   **Command:** `svmap <Target_IP_Range>`
*   **Metasploit SIP Username Enumerator:** Scans for numeric usernames/extensions of VoIP phones.

> ‚ö†Ô∏è **Post-Enumeration Attacks:** DoS, Session Hijacking, Caller ID Spoofing, Eavesdropping, SPIT (Spam), and Vishing.

---

## 3. RPC Enumeration

**Remote Procedure Call (RPC)** enables inter-process communication in distributed client/server programs.
- **Portmapper Service:** Listens on **TCP/UDP Port 111**.

### üîç Analysis Techniques
*   **Components:** Client, Server, Endpoint, Endpoint Mapper, Client/Server Stubs.
*   **Nmap Commands:**
    -   `nmap -sR <Target_IP>` (Identify RPC services).
    -   `nmap -T4 ‚ÄìA <Target_IP>` (Detailed aggressive scan).
*   **NetScanTools Pro:** Includes an **RPC Info** tool to access the portmapper daemon (Port 111) on Unix/Linux machines.

---

## 4. Unix/Linux User Enumeration

Extracts usernames, hostnames, and session start dates/times.

### üìã Utility Flag Reference

#### **rusers**
Displays users logged into machines on the local network (similar to `who`).
- **Syntax:** `/usr/bin/rusers [-a] [-l] [-u| -h| -i] [Host ...]`
- `-a`: Report machines even with no users logged in.
- `-h`: Sort alphabetically by hostname.
- `-l`: Long listing (similar to `who`).
- `-u`: Sort by number of users.
- `-i`: Sort by idle time.

#### **rwho -a**
Displays users on the local network running the `rwho` daemon. 
- `-a`: Includes users idle for over one hour.

#### **finger**
Displays detailed system user info (Home dir, shell, .plan, etc.).
- **Syntax:** `finger [-l] [-m] [-p] [-s] [user@host ...]`
- `-s`: Short output (Login, Real Name, Terminal, Idle, Office info).
- `-l`: Multi-line format (Home dir, Shell, Mail, `.plan`, `.project`, `.pgpkey`).
- `-p`: Prevents displaying `.plan`, `.project`, and `.pgpkey`.
- `-m`: Prevents username matching.

---

## 5. SMB Enumeration

**Server Message Block (SMB)** is used for shared access to files and printers.
- **Native Port:** **TCP 445**.
- **NetBIOS API:** **UDP 137, 138** & **TCP 137, 139**.

### ÔøΩÔ∏è SMB Discovery & NSE Scripts
- **Tools:** Nmap, SMBMap, enum4linux, nullinux, SMBeagle, NetScanTool Pro.
- **Banner Grabbing:** Obtain OS details and service versions.
- **Nmap Enumeration:**
  - `nmap -p 445 -A <Target_IP>` (Aggressive scan for OS and shares).
  - `nmap -p 445 --script smb-protocols <Target_IP>` (Lists supported protocols).
- **AI Prompt:** *"Scan the target IP 10.10.1.22 for the port using SMB with nmap"*
  - **Command:** `nmap -p 445 --script smb-enum-shares 10.10.1.22`

---

## 6. Creating & Running Custom AI Automation Scripts

Attackers leverage AI to generate automation scripts for complex enumeration tasks.

### üìú AI Prompt for Automation
*"Develop and execute a script that will automate network enumeration tasks on target IP range 10.10.1.0/24"*

### ‚öôÔ∏è The Automation Script (`network_enumeration.sh`)
```bash
#!/bin/bash
target_range="10.10.1.0/24"

# 1. Environment Setup
sudo apt-get update && sudo apt-get install -y nmap
mkdir -p ~/enumeration_results

# 2. Sequential Scans
nmap -sn $target_range -oN ~/enumeration_results/ping_sweep.txt         # Ping Sweep
nmap -T4 -F $target_range -oN ~/enumeration_results/quick_scan.txt      # Common Ports
nmap -T4 -A $target_range -oN ~/enumeration_results/detailed_scan.txt   # OS/Version/Scripts
nmap -sV $target_range -oN ~/enumeration_results/version_detection.txt  # Service Versions

# 3. Execution
chmod +x network_enumeration.sh && ./network_enumeration.sh
```

---

## 7. CEH Exam Traps & Tips

| ‚ö†Ô∏è Common Trap | ‚úÖ Correct Understanding |
| :--- | :--- |
| **ISAKMP Scans** | Use **UDP Scan (-sU)** for port 500, as TCP will yield no result. |
| **Vishing vs SPIT** | **Vishing** is VoIP phishing; **SPIT** is spam over internet telephony. |
| **Portmapper filtering** | If Port 111 is filtered, attackers must scan wide port ranges to find the dynamically assigned RPC services. |
| **finger Security** | Disabling `finger` is a standard hardening step to prevent username enumeration. |
| **SMB NULL Session** | SMB enumeration on Port 445 is often the first step towards establishing a **Null Session** to pull the RID. |

---

*üìö CEH v13 ¬∑ Module 04: Enumeration | Last updated: February 2026*
