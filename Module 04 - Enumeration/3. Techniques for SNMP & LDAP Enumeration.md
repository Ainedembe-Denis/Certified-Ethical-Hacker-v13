# üì° 3. Techniques for SNMP & LDAP Enumeration
### CEH v13 ¬∑ Module 04: Enumeration

> **About these notes:** This guide explores deep-dive techniques for enumerating Simple Network Management Protocol (SNMP) and Lightweight Directory Access Protocol (LDAP) to extract users, network topology, and directory listings.

---

## üìë Table of Contents

1. [SNMP Enumeration Concepts](#1-snmp-enumeration-concepts)
   - [SNMP Architecture & Ports](#-snmp-architecture--ports)
   - [Community Strings (Passwords)](#-community-strings-passwords)
2. [How SNMP Works (Operations)](#2-how-snmp-works-operations)
3. [Management Information Base (MIB)](#3-management-information-base-mib)
   - [Major MIBs Table](#-major-mibs-table)
4. [SNMP Enumeration Tools & Commands](#4-snmp-enumeration-tools--commands)
   - [SnmpWalk Reference](#-snmwalk-reference)
   - [Nmap SNMP Scripts](#-nmap-snmp-scripts)
5. [LDAP Enumeration Concepts](#5-ldap-enumeration-concepts)
6. [Manual LDAP Enumeration (Python)](#6-manual-ldap-enumeration-python)
7. [Automated LDAP Enumeration (Nmap & Tools)](#7-automated-ldap-enumeration-nmap--tools)
   - [Ldapsearch Command Reference](#-ldapsearch-command-reference)
8. [CEH Exam Traps & Tips (SNMP/LDAP)](#8-ceh-exam-traps--tips-snmpldap)

---

## 1. SNMP Enumeration Concepts

Simple Network Management Protocol (SNMP) allows administrators to manage network devices (routers, switches, hubs) remotely. Attackers exploit it to dump user accounts, ARP tables, and device-specific data.

### üèóÔ∏è SNMP Architecture & Ports
- **SNMP Manager:** Sends requests and receives traps.
- **SNMP Agent:** Runs on the network device; listens and replies.
- **Ports:**
  - **UDP 161:** General SNMP queries.
  - **UDP 162:** SNMP Traps (Unsolicited alerts sent from agent to manager).

### üîë Community Strings (Passwords)
| String Type | Usage | CEH Insight |
| :--- | :--- | :--- |
| **Read Community** | Viewing device configurations | Default is often `public`. |
| **Read/Write Community** | Editing device configurations | Default is often `private`. |

---

## 2. How SNMP Works (Operations)

SNMP uses Protocol Data Units (PDUs) for information exchange:

| Operation | Purpose |
| :--- | :--- |
| **Get Request** | Retrieve a specific variable (e.g., interface status). |
| **GetNext Request** | Fetch the next variable in the MIB tree (sequential). |
| **GetBulk Request** | (SNMPv2+) Retrieves large volumes of data in one go. |
| **Set Request** | Modify a variable (change device behavior). |
| **Response** | Agent's reply containing the requested values. |
| **Trap** | **Unsolicited** message from Agent to Manager about an event (e.g., reboot). |
| **Inform Request** | Manager-to-Manager communication (confirmed traps). |

---

## 3. Management Information Base (MIB)

The MIB is a virtual database of network objects organized hierarchically. Objects are identified via **Object Identifiers (OIDs)**‚Äînumeric strings like `1.3.6.1.2.1`.

### üóÉÔ∏è Major MIBs Table
| MIB Name | Function |
| :--- | :--- |
| **DHCP.MIB** | Monitors traffic between DHCP servers and hosts. |
| **HOSTMIB.MIB** | Manages host-specific resources (CPU, RAM). |
| **LNMIB2.MIB** | Objects for Windows Workstation and Server services. |
| **MIB_II.MIB** | Standard management for TCP/IP-based internet. |
| **WINS.MIB** | For the Windows Internet Name Service. |

---

## 4. SNMP Enumeration Tools & Commands

### üö∂ SnmpWalk Reference
`snmpwalk` scans numerous nodes instantly.
- **Basic Enumeration:** `snmpwalk -v1 -c public <Target_IP>`
- **Enumerate SNMPv2:** `snmpwalk -v2c -c public <Target_IP>`
- **Installed Software:** `snmpwalk -v2c -c public <Target_IP> hrSWInstalledName`
- **Host RAM Info:** `snmpwalk -v2c -c public <Target_IP> hrMemorySize`
- **Edit OID (sysContact):** `snmpwalk -v2c -c public <Target_IP> sysContact <NewValue>`

### üõ∞Ô∏è Nmap SNMP Scripts
- **Processes:** `nmap -sU -p 161 --script snmp-processes <IP>`
- **System Description:** `nmap -sU -p 161 --script snmp-sysdescr <IP>`
- **Win32 Software:** `nmap -sU -p 161 --script snmp-win32-software <IP>`
- **General Info (AI Suggested):** `nmap -sU -p 161 --script snmp-info <IP>`

> üìç **Other Tools:** OpUtils, Network Performance Monitor, PRTG, `snmp-check` (open-source), SoftPerfect Network Scanner.

---

## 5. LDAP Enumeration Concepts

The Lightweight Directory Access Protocol (LDAP) is used to access distributed directory services like **Active Directory (AD)**. It works on **TCP port 389** (LDAPS on **636**).

- **Attack Surface:** Anonymous queries can leak usernames, addresses, department details, and server names.
- **Hierarchical:** Similar to an organizational chart; uses DNS for resolution.

---

## 6. Manual LDAP Enumeration (Python)

Attackers use the `ldap3` library to manually query the Directory System Agent (DSA).

```python
import ldap3
# 1. Create Server Object
server = ldap3.Server('<Target_IP>', get_info=ldap3.ALL, port=389)
# 2. Create Connection
connection = ldap3.Connection(server)
# 3. Bind to the Server
if connection.bind():
    print("Success!")
# 4. Search and Dump everything (Subtree)
connection.search(search_base='DC=DOMAIN,DC=LOCAL', 
                  search_filter='(&(objectClass=*))', 
                  search_scope='SUBTREE', attributes='*')
print(connection.entries)
```

---

## 7. Automated LDAP Enumeration (Nmap & Tools)

### üîë Automated Brute-Force
- **Nmap:** `nmap -p 389 --script ldap-brute <target>` ‚Äî Uses built-in lists to crack auth.

### üõ†Ô∏è Ldapsearch Command Reference
`ldapsearch` is a shell interface for the LDAP library.
- **Simple Auth Search:** `ldapsearch -h <IP> -x`
- **Get Naming Contexts:** `ldapsearch -h <IP> -x -s base namingcontexts`
- **Dump Primary Domain:** `ldapsearch -h <IP> -x -b "DC=htb,DC=local"`
- **Filter by Employee Class:** `ldapsearch -h <IP> -x -b "DC=htb,DC=local" '(objectClass=Employee)'`
- **Get Specific Attributes:** `ldapsearch -h <IP> -x -b "DC=htb,DC=local" '(objectClass=Employee)' sAMAccountName sAMAccountType`

> üìç **GUI Tools:** Softerra LDAP Administrator, AD Explorer, LDAP Account Manager.

---

## 8. CEH Exam Traps & Tips (SNMP/LDAP)

| ‚ö†Ô∏è Common Trap | ‚úÖ Correct Understanding |
| :--- | :--- |
| **SNMP Port Confusion** | Queries = **UDP 161**; Alerts (Traps/Informs) = **UDP 162**. |
| **SNMPv3 Security** | Introduces **Notifications** (Traps + Informs) with encryption and auth. |
| **LDAP Bind** | An `anonymous bind` can reveal the entire corporate directory if misconfigured. |
| **MIB File Browsing** | You can browse them via web: `http://<IP>/Lseries.mib`. |
| **BER Format** | LDAP uses the **Basic Encoding Rules (BER)** format for data transfer. |

---

*üìö CEH v13 ¬∑ Module 04: Enumeration | Last updated: February 2026*
