# üì° 3. Techniques for SNMP & LDAP Enumeration
### CEH v13 ¬∑ Module 04: Enumeration

> **About these notes:** This guide explores deep-dive techniques for enumerating Simple Network Management Protocol (SNMP) and Lightweight Directory Access Protocol (LDAP) to extract users, network topology, and directory listings.

---

## üìë Table of Contents

1. [SNMP Enumeration Concepts](#1-snmp-enumeration-concepts)
   - [SNMP Architecture & Ports](#-snmp-architecture--ports)
   - [Community Strings (Passwords)](#-community-strings-passwords)
2. [Working of SNMP (Operations & PDUs)](#2-working-of-snmp-operations--pdus)
3. [Management Information Base (MIB)](#3-management-information-base-mib)
   - [Major MIBs Table](#-major-mibs-table)
4. [SNMP Enumeration Tools & Commands](#4-snmp-enumeration-tools--commands)
   - [SnmpWalk Reference](#-snmwalk-reference)
   - [Nmap SNMP Scripts](#-nmap-snmp-scripts)
   - [Additional Tools Overview](#-additional-tools-overview)
5. [LDAP Enumeration Concepts](#5-ldap-enumeration-concepts)
6. [Manual LDAP Enumeration (Python)](#6-manual-ldap-enumeration-python)
7. [Automated LDAP Enumeration (Nmap & Tools)](#7-automated-ldap-enumeration-nmap--tools)
   - [Ldapsearch Command Reference](#-ldapsearch-command-reference)
   - [LDAP Tool Suite](#-ldap-tool-suite)
8. [CEH Exam Traps & Tips (SNMP/LDAP)](#8-ceh-exam-traps--tips-snmpldap)

---

## 1. SNMP Enumeration Concepts

Simple Network Management Protocol (SNMP) allows administrators to manage network devices (routers, switches, hubs) remotely. Attackers exploit vulnerabilities like lack of auditing to perform account and device enumeration.

### üèóÔ∏è SNMP Architecture & Components
- **SNMP Agent:** Located on the networking device; initializes configuration on boot and listens on **UDP 161**.
- **SNMP Management Station (Manager):** Communicates with the agent to set/get variables or receive traps.
- **Protocol Type:** Application-layer protocol running over UDP.

### üîë Community Strings (Passwords)
Community strings act as passwords for accessing the SNMP agent.
| String Type | Usage | CEH Insight |
| :--- | :--- | :--- |
| **Read Community** | View device configuration | Publicly known as `public` by default. |
| **Read/Write Community** | Change/Edit configuration | Private; often left as `private` by default. |

> ‚ö†Ô∏è **Attacker Goal:** Extract ARP tables, routing tables, traffic stats, and device-specific info.

---

## 2. Working of SNMP (Operations & PDUs)

SNMP communication involves Protocol Data Units (PDUs) to exchange data.

| Operation | Purpose | Key Detail |
| :--- | :--- | :--- |
| **Get Request** | Retrieve a specific variable value. | Manager $\rightarrow$ Agent. |
| **GetNext Request** | Fetch the next variable in the MIB tree. | Used to walk through a sequence. |
| **GetBulk Request** | Retrieve large volumes of data. | Introduced in **SNMPv2**. |
| **Set Request** | Modify a variable's value. | Effectively changes device behavior. |
| **Response** | Agent's reply to Manager requests. | Contains values or acknowledgment. |
| **Inform Request** | Unsolicited info (Manager-to-Manager). | Used for significant events/errors. |
| **Trap** | **Unsolicited** Agent alert to Manager. | Events like reboots/interface failure. |

---

## 3. Management Information Base (MIB)

The MIB is a virtual database providing a formal description of all network objects.
- **OIDs (Object Identifiers):** Numeric names (e.g., `1.3.6...`) starting from the root of the MIB tree.
- **Scalar Objects:** Define a single object instance.
- **Tabular Objects:** Define a group of related instances.
- **Accessing MIBs:** Can be browsed via web: `http://<IP>/Lseries.mib`.

### üóÉÔ∏è Major Microsoft MIBs Table
| MIB File | Primary Function |
| :--- | :--- |
| **DHCP.MIB** | Monitors traffic between DHCP servers and remote hosts. |
| **HOSTMIB.MIB** | Monitors and manages host resources (CPU, RAM, storage). |
| **LNMIB2.MIB** | Contains object types for Workstation and Server services. |
| **MIB_II.MIB** | Manages TCP/IP-based Internet utilizing simple architecture. |
| **WINS.MIB** | For the Windows Internet Name Service (WINS). |

---

## 4. SNMP Enumeration Tools & Commands

### üö∂ SnmpWalk Reference
[SnmpWalk](https://ezfive.com) allows attackers to scan numerous nodes and identify available variables.
- **Basic v1 Scan:** `snmpwalk -v1 -c public <Target_IP>`
- **SNMPv2c Scan:** `snmpwalk -v2c -c public <Target_IP>`
- **Find Installed Software:** `snmpwalk -v2c -c public <Target_IP> hrSWInstalledName`
- **Determine Host RAM:** `snmpwalk -v2c -c public <Target_IP> hrMemorySize`
- **Change OID Value:** `snmpwalk -v2c -c public <Target_IP> <OID> <New_Value>`
- **Change sysContact:** `snmpwalk -v2c -c public <Target_IP> sysContact <New_Value>`

### üõ∞Ô∏è Nmap SNMP Scripts
[Nmap](https://nmap.org) uses its scripting engine (NSE) for deep SNMP extraction.
- **Running Processes:** `nmap -sU -p 161 --script=snmp-processes <Target_IP>`
- **System Description:** `nmap -sU -p 161 --script=snmp-sysdescr <Target_IP>`
- **Win32 Software:** `nmap -sU -p 161 --script=snmp-win32-software <Target_IP>`
- **General Info (AI Prompt):** `nmap -sU -p 161 --script snmp-info <Target_IP>`

### ÔøΩÔ∏è Additional Tools Overview
| Tool | Source / URL | Capability |
| :--- | :--- | :--- |
| **snmp-check** | [nothink.org](https://www.nothink.org) | Automates gathering contact, devices, mountpoints, etc. |
| **SoftPerfect Scanner** | [softperfect.com](https://www.softperfect.com) | Port scanner that retrieves info via WMI, SNMP, and SSH. |
| **Network Perf. Monitor** | [solarwinds.com](https://www.solarwinds.com) | Enterprise-grade monitoring and diagnostics. |
| **OpUtils** | [manageengine.com](https://www.manageengine.com) | Scans for IP/MAC/SNMP info across entire ranges. |
| **Engineer‚Äôs Toolset** | [solarwinds.com](https://www.solarwinds.com) | Comprehensive suite for diagnostics and troubleshooting. |
| **PRTG Network Monitor** | [paessler.com](https://www.paessler.com) | Monitors network device traffic and health via SNMP. |

---

## 5. LDAP Enumeration Concepts

The Lightweight Directory Access Protocol (LDAP) accesses directory listings in Active Directory or other services.
- **Infrastructure:** Client connects to a **Directory System Agent (DSA)** on **TCP 389** (Standard) or **636** (Secure).
- **Encoding:** Uses **Basic Encoding Rules (BER)** format for data transmission.
- **Hierarchy:** Logical directory structure (like an org chart).

---

## 6. Manual LDAP Enumeration (Python)

Attackers use the `ldap3` library to manually interact with directory objects.

```python
import ldap3
# 1. Initialize Server (Include get_info to pull DSE contexts)
server = ldap3.Server('<Target_IP>', get_info=ldap3.ALL, port=389)
# 2. Establish Connection
connection = ldap3.Connection(server)
# 3. Bind (returns True if successful)
if connection.bind():
    # 4. Dump Server Info/Naming Contexts
    print(server.info)
    # 5. Search Subtree for all objects
    connection.search(search_base='DC=DOMAIN,DC=LOCAL', 
                      search_filter='(&(objectClass=*))', 
                      search_scope='SUBTREE', attributes='*')
    print(connection.entries)
```

---

## 7. Automated LDAP Enumeration (Nmap & Tools)

### ÔøΩÔ∏è Nmap LDAP Scripts
- **Brute Force Auth:** `nmap -p 389 --script ldap-brute <Target_IP>`

### üõ†Ô∏è Ldapsearch Command Reference
[ldapsearch](https://linux.die.net) is the primary shell interface for directory queries.
- **Simple Anonymous Bind:** `ldapsearch -h <IP> -x`
- **Query Naming Contexts:** `ldapsearch -h <IP> -x -s base namingcontexts`
- **Search Primary Domain:** `ldapsearch -h <IP> -x -b "DC=htb,DC=local"`
- **Filter for Objects:** `ldapsearch -x -h <IP> -b "DC=htb,DC=local" "objectclass=*"`
- **Specific Attributes:** `ldapsearch -h <IP> -x -b "DC=htb,DC=local" '(objectClass=Employee)' sAMAccountName sAMAccountType`

### ÔøΩ LDAP Tool Suite
| Tool | Source / URL | Usage |
| :--- | :--- | :--- |
| **Softerra LDAP Admin** | [ldapadministrator.com](https://www.ldapadministrator.com) | GUI tool to browse and manage AD/LDAP directories. |
| **AD Explorer** | [docs.microsoft.com](https://docs.microsoft.com) | Sysinternals tool to view and browse AD databases. |
| **LDAP Account Manager** | [ldap-account-manager.org](https://www.ldap-account-manager.org) | Web-based management for LDAP entries. |
| **LDAP Admin Tool** | [ldapsoft.com](https://www.ldapsoft.com) | Professional AD management and browsing utility. |

---

## 8. CEH Exam Traps & Tips (SNMP/LDAP)

| ‚ö†Ô∏è Common Trap | ‚úÖ Correct Understanding |
| :--- | :--- |
| **Manager vs Agent Ports** | Requests/Responses travel to **UDP 161**; Traps/Alerts go to **UDP 162**. |
| **SNMPv3 Security** | The only version providing high-level authentication and encryption. |
| **Community String public** | It's a `Read-Only` community string, NOT a username. |
| **LDAP Port 636** | Specifically used for **LDAP over SSL (LDAPS)**. |
| **BER Encoding** | The standard data transfer format for LDAP communication. |

---

*üìö CEH v13 ¬∑ Module 04: Enumeration | Last updated: February 2026*
