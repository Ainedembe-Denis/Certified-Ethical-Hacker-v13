# üõ°Ô∏è 7. Enumeration Countermeasures
### CEH v13 ¬∑ Module 04: Enumeration

> **About these notes:** This exhaustive guide covers every defensive control and countermeasure required to prevent information leakage through SNMP, LDAP, NFS, SMTP, SMB, and DNS.

---

## üìë Table of Contents

1. [SNMP Countermeasures](#1-snmp-countermeasures)
2. [LDAP Countermeasures](#2-ldap-countermeasures)
3. [NFS Countermeasures](#3-nfs-countermeasures)
4. [SMTP Countermeasures](#4-smtp-countermeasures)
5. [SMB Countermeasures](#5-smb-countermeasures)
6. [DNS Countermeasures](#6-dns-countermeasures)
7. [Unified Defense Checklist](#7-unified-defense-checklist)

---

## 1. SNMP Countermeasures

*   **Service Hygiene:** Remove the SNMP agent or turn off the service if not needed. Disable management/monitoring components if unused.
*   **Version Upgrade:** **Upgrade to SNMPv3** to enable encrypted passwords and messages. Avoid "NoAuthNoPriv" mode; use **"AuthNoPriv"** (MD5/SHA) for added protection.
*   **Credentials:** Change default community strings (public/private) to complex values. Periodically rotate passwords.
*   **Access Control (ACLs):**
    - Configure ACLs to allow only legitimate users/IPs to access devices.
    - Implement the security option: **‚ÄúAdditional restrictions for anonymous connections‚Äù**.
    - Implement Role-Based Access Control (RBAC).
*   **Registry & Ports:** Modify the registry to permit access only to specific community names. Block **TCP/UDP Port 161**.
*   **Network Isolation:** Keep management traffic on a **separate, secure VLAN**.
*   **Monitoring:** Implement anomaly detection for unusual traffic patterns. Log all access and audit logs regularly for unauthorized attempts.
*   **Maintenance:** Identify all R/W devices and change to **Read-Only** where possible. Apply all security patches immediately.

---

## 2. LDAP Countermeasures

*   **Traffic Encryption:** Use **SSL (LDAPS)** or **STARTTLS** for all traffic.
*   **Identity Management:**
    - Choose usernames different from email addresses.
    - Enable **Account Lockout** policies and enforce strong passwords.
    - Implement **Multi-Factor Authentication (MFA)**.
*   **Active Directory Hardening:**
    - Log all AD access. Use software like Citrix to restrict AD interaction.
    - Use NTLM, Kerberos, or other basic authentication mechanisms.
    - Block users from specific AD entities by tightening object/attribute permissions.
*   **Deception Tactics:**
    - Deploy **Canary Accounts** (realistic decoys) to mislead attackers.
    - Create **Decoy Groups** with "Admin" in the name to trigger alerts during enumeration.
*   **Infrastructure:** Disable **Anonymous Binds**. Place servers in secure, segmented network zones and use firewalls to restrict traffic to authorized systems.

---

## 3. NFS Countermeasures

*   **Network Level Defense:** Block **NFS Port 2049** at the firewall. Place servers/clients in segmented secure networks.
*   **System Configuration:** 
    - Verify `/etc/exports`, `/etc/smb.conf`, and `/etc/hosts.allow`.
    - Use `/etc/hosts.allow` and `/etc/hosts.deny` for strict IP/host filtering.
*   **Security Options:**
    - **root_squash:** MUST be **ON** in `/etc/exports` to demote remote root access to anonymous.
    - Disable execution of **SUID** and **SGID** on exported filesystems.
    - Ensure **NIS netgroups** have fully defined hostnames.
*   **Encryption & Auth:** Use **NFSv4** for Kerberos support. Implement **NFS Tunneling** via SSH for legacy systems.
*   **Maintenance:** Patch regularly. Monitor server logs and use file system auditing tools to detect unauthorized access or modifications. Use DPI (Deep Packet Inspection) firewalls.

---

## 4. SMTP Countermeasures

*   **Command Hardening:** Disable **EXPN**, **VRFY**, and **RCPT TO** commands (or limit to authenticated users).
*   **Server Logic:**
    - Ignore email messages to unknown recipients.
    - Disable the **Open Relay** feature.
    - Limit information in error messages (avoid verbose responses).
*   **Information Concealment:** Do not share internal IP/host info or mail relay system details in mail responses.
*   **Spam & Integrity Defense:**
    - Implement **SPF**, **DKIM**, and **DMARC**.
    - Use AI/Machine Learning (ML) solutions to identify spammers.
*   **Security Controls:** Require authentication for all access. Use **TLS** for communication. Implement **Rate Limiting** and source connection limits to prevent brute-force.
*   **Auditing:** Log all access attempts and command usage. Analyze logs for unusual patterns (e.g., high failed login counts).

---

## 5. SMB Countermeasures

*   **Service Hardening:** Disable SMB on **DNS and Web servers (Bastion Hosts)**. Disable "Client for Microsoft Networks" and "File and Printer Sharing" on Internet-facing systems.
*   **Port Blocking:** Block **TCP Ports 88, 139, 445** and **UDP Ports 88, 137, 138**.
*   **Registry Correction:**
    - **Key:** `HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\LanmanServer\Parameters`
    - **Value:** Set **`RestrictNullSessAccess`** to **1** (Enabled).
*   **Security Policy:**
    - Mandate **SMBv3+**; strictly **disable SMBv1**.
    - Implement digitally signed communications.
    - Use Least Privilege and strict ACLs for all shares.
*   **Monitoring:** Use Next-Generation Firewalls (NGFWs) for file behavioral analysis. Employ global threat sensors for top-secret data.
*   **Hygiene:** Enable Windows Firewall/Endpoint Protection. Apply latest security patches. Perform regular system log audits and active monitoring.

---

## 6. DNS Countermeasures

*   **Zone Transfer Control:** **Restict AXFR requests** to specific slave IP addresses only. Disable transfers to untrusted hosts.
*   **Recursive Queries:** Disable **DNS Recursion** to prevent amplification and poisoning attacks.
*   **Privacy & Encryption:** Implement **DNS-over-HTTPS (DoH)** or **DNS-over-TLS (DoT)**. Use premium DNS registrations to hide **HINFO** records.
*   **Architecture:**
    - Use **Split-DNS** (Separate internal/external servers).
    - Separate Authoritative and Resolving functions onto different servers.
    - Do not host application servers on the same hardware as DNS.
*   **Query Hardening:** Randomize source ports, Query IDs, and alphabet case of domain names. Use **DNSSEC** for digital signatures.
*   **Server Defense:** Implement **Rate Limiting**, Anomaly Detection, and DNS Firewalls. Enable logging and monitor for unusual query volumes.
*   **Record Hygiene:** Delete old/unused records. Prune zone files to reveal minimal info. Do not publish private host IPs in public zone files. Use `/etc/hosts` for dev subdomains instead of DNS records.
*   **Access Management:** Use **DNS Change Lock** (Client lock). Implement 2FA and OS Hardening (closing unused ports). Use standard network admin contacts primarily for registrations.

---

## 7. Unified Defense Checklist

| Countermeasure Category | Core Exam Recommendation |
| :--- | :--- |
| **SNMP Defense** | **Upgrade to SNMPv3** is the single best defense. |
| **LDAP Logic** | Use **Decoy groups** and **Canary accounts** to trap enumerators. |
| **NFS Security** | **root_squash = ON** is a mandatory security baseline. |
| **SMTP Probing** | **Disable VRFY/EXPN** to stop user enumeration. |
| **SMB Restriction** | **RestrictNullSessAccess = 1** stops anonymous null sessions. |
| **DNS Privacy** | **Split-DNS** and **AXFR restrictions** are the primary mapping defenses. |

---

*üìö CEH v13 ¬∑ Module 04: Enumeration | Last updated: February 2026*
