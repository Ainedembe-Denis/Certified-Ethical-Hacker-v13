# ‚è≤Ô∏è 4. Techniques for NTP & NFS Enumeration
### CEH v13 ¬∑ Module 04: Enumeration

> **About these notes:** This objective focuses on Network Time Protocol (NTP) and Network File System (NFS)‚Äîtwo protocols often overlooked by administrators that can leak internal network structure, client IPs, and shared files.

---

## üìë Table of Contents

1. [NTP Enumeration Overview](#1-ntp-enumeration-overview)
2. [NTP Enumeration Commands](#2-ntp-enumeration-commands)
   - [ntpdate, ntptrace, ntpdc, ntpq](#-ntpdate-ntptrace-ntpdc-ntpq)
3. [NTP Enumeration Tools & Sources](#3-ntp-enumeration-tools--sources)
4. [NFS Enumeration Overview](#4-nfs-enumeration-overview)
5. [NFS Enumeration Commands](#5-nfs-enumeration-commands)
6. [NFS Enumeration Tools & Commands](#6-nfs-enumeration-tools--commands)
7. [CEH Exam Traps & Tips (NTP/NFS)](#7-ceh-exam-traps--tips-ntpnfs)

---

## 1. NTP Enumeration Overview

NTP synchronizes clocks of networked computers on **UDP port 123**. 

### üéØ Critical Information Leaked
*   **Host Lists:** A list of all hosts connected to the NTP server.
*   **System Details:** Client IP addresses, system names, and Operating Systems.
*   **Internal Topology:** If the server is in a **DMZ**, it can reveal internal IP addresses.
*   **Accuracy:** 10 ms over public internet; **200 Œºs** in LANs.

> üìí **System Note:** In modern Linux distributions (e.g., CentOS/RHEL 7+), the `ntp` daemon has been merged with or replaced by **Chrony** (`chronyd`).

---

## 2. NTP Enumeration Commands

### üõ†Ô∏è ntpdate
Collects time samples from several time sources.
**Syntax:** `ntpdate [-46bBdqsuv] [-a key] [-e authdelay] [-k keyfile] [-o version] [-p samples] [-t timeout] [ -U user_name] server [...]`

| Parameter | Function |
| :--- | :--- |
| **-4 / -6** | Force IPv4 or IPv6 DNS resolution. |
| **-b / -B** | **Double-step** (force jump) vs **Slew** (gradual adjustment). |
| **-d** | **Debugging Mode:** Prints all details without setting the clock. (Vital for attackers). |
| **-q** | Query only‚Äîdoes not set the clock. |
| **-s** | Log message to syslog facility rather than stdout. |
| **-u** | Use an unprivileged port for outgoing packets (bypasses some firewalls). |
| **-v** | Verbose mode (displays version and source info). |

### üõ†Ô∏è ntptrace
Traces the chain of NTP servers back to the primary source (Stratum 1).
**Syntax:** `ntptrace [-n] [-m maxhosts] [servername/IP_address]`
- `-n`: Print IP addresses instead of hostnames.
- `-m`: Maximum number of hosts to trace.

**Example Execution:**
```bash
# ntptrace localhost
stratum 4, offset 0.0019529, synch distance 0.143235  # Local Client
10.10.0.1: stratum 2, offset 0.0114273, synch distance 0.115554
10.10.1.1: stratum 1, offset 0.0017698, synch distance 0.011193 # Primary Source
```

### üõ†Ô∏è ntpdc & ntpq
*   **ntpdc:** Queries the `ntpd` daemon regarding current state and statistics.
    *   **Syntax:** `ntpdc [ -46dilnps ] [ -c command] [hostname/IP_address]`
*   **ntpq:** Monitors `ntpd` performance and daemon operations.
    *   **Syntax:** `ntpq [-46dinp] [-c command] [host/IP_address]`
    *   **Interative Examples:** `ntpq> version`, `ntpq> host`.

---

## 3. NTP Enumeration Tools & Sources

| Tool | Official Source / URL | Key Capability |
| :--- | :--- | :--- |
| **PRTG Network Monitor** | [paessler.com](https://www.paessler.com) | Monitors IT infrastructure; retrieves SNTP response times and active sensors. |
| **Nmap** | [nmap.org](https://nmap.org) | Scans for UDP 123 and contains NSE scripts for detailed probing. |
| **Wireshark** | [wireshark.org](https://www.wireshark.org) | Protocol analysis to identify NTP traffic patterns. |
| **udp-proto-scanner** | [labs.portcullis.co.uk](https://labs.portcullis.co.uk) | Targeted UDP service discovery and probing. |
| **NTP Server Scanner** | [bytefusion.com](http://www.bytefusion.com) | Verifies connectivity and verifies configuration from client to server. |

---

## 4. NFS Enumeration Overview

NFS enables remote file access that appears local, relying on **Remote Procedure Call (RPC)**.

### üîë Key Concepts
*   **Exporting:** The process of making a directory available on the server.
*   **Mounting:** The process of the client making a remote directory available locally.
*   **Security:** Primarily **IP-address based**.
*   **Configuration:** The `/etc/exports` file on the server contains the list of allowed clients/IPs.

---

## 5. NFS Enumeration Commands

Attackers perform these steps to identify shared directories and target IP addresses for spoofing.

### üîç rpcinfo
Queries the portmapper (Port 111) to find active NFS services (Port 2049).
- **Command:** `rpcinfo -p <Target_IP>`

### üîç showmount
Displays the "Exports" list from a target NFS server.
- **Command:** `showmount -e <Target_IP>`
- **Insight:** Reveals shared directories and authorized subnets/clients.

---

## 6. NFS Enumeration Tools & Commands

Tools scan IP ranges to identify NFS shares and misconfigurations.

### üõ†Ô∏è RPCScan
Communicates with RPC services and checks for NFS share misconfigurations.
*   **Source:** [github.com](https://github.com)
*   **Execution:** `python3 rpc-scan.py <Target_IP> --rpc`

### üõ†Ô∏è SuperEnum
Includes a script to perform basic enumeration on port 2049 across large IP lists.
*   **Source:** [github.com](https://github.com)
*   **Execution:** `./superenum` (Provide a `Target.txt` with a list of IPs).

---

## 7. CEH Exam Traps & Tips (NTP/NFS)

| ‚ö†Ô∏è Common Trap | ‚úÖ Correct Understanding |
| :--- | :--- |
| **The monlist Trap** | `ntpdc -c monlist` is the most famous NTP enumeration vulnerability (CVE-2013-5211). |
| **NFS Security** | Pre-v4 NFS relies on the **client's IP address** for authentication‚Äîmaking it highly susceptible to **IP spoofing**. |
| **RPC & Port 111** | NFS depends on the **Portmapper** service on port 111 (TCP/UDP) to locate the NFS port (2049). |
| **Stratum 1** | A server with `stratum 1` is a primary time source (usually connected to an atomic clock or GPS). |
| **/etc/exports** | The master configuration file for NFS shares; an attacker's primary "loot" target. |

---

*üìö CEH v13 ¬∑ Module 04: Enumeration | Last updated: February 2026*