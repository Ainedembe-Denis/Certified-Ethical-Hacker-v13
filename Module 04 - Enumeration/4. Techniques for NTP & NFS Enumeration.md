# ‚è≤Ô∏è 4. Techniques for NTP & NFS Enumeration
### CEH v13 ¬∑ Module 04: Enumeration

> **About these notes:** This objective covers NTP and NFS‚Äîtwo protocols that are often under-secured but can leak sensitive internal network details and client lists.

---

## üìë Table of Contents

1. [NTP Enumeration Overview](#1-ntp-enumeration-overview)
2. [NTP Enumeration Commands](#2-ntp-enumeration-commands)
   - [ntpdate, ntptrace, ntpdc, ntpq](#-ntpdate-ntptrace-ntpdc-ntpq)
3. [NTP Enumeration Tools](#3-ntp-enumeration-tools)
4. [NFS Enumeration Overview](#4-nfs-enumeration-overview)
5. [NFS Enumeration Commands](#5-nfs-enumeration-commands)
   - [rpcinfo & showmount](#-rpcinfo--showmount)
6. [NFS Enumeration Tools](#6-nfs-enumeration-tools)
7. [Exploitation after NFS Enumeration](#7-exploitation-after-nfs-enumeration)
8. [CEH Exam Traps & Tips (NTP/NFS)](#8-ceh-exam-traps--tips-ntpnfs)

---

## 1. NTP Enumeration Overview

**Network Time Protocol (NTP)** synchronizes clocks over a network. It uses **UDP port 123**.

### üéØ Why Attackers Enumerate NTP
- **Network Mapping:** Reveal a list of hosts connected to the server.
- **Client Intel:** Extract IP addresses, system names, and operating systems.
- **Infiltrating the DMZ:** Identify internal IP addresses if the NTP server bridges the DMZ and internal networks.

> üí° **Accuracy:** NTP can maintain time within **10 ms** over the internet and up to **200 Œºs** in ideal LAN conditions.

---

## 2. NTP Enumeration Commands

| Command | Purpose | Attacker's Use Case |
| :--- | :--- | :--- |
| **ntpdate** | Collects time samples from sources. | Use `-d` (debug) to reveal server/client IPs and topology. |
| **ntptrace** | Traces the chain of NTP servers. | Follows the chain back to the primary source (stratum 1). |
| **ntpdc** | Queries ntpd for state and stats. | Can retrieve lists of connected peers and statistics. |
| **ntpq** | Monitors ntpd performance. | Queries peers and checks synchronization performance. |

### üîß Command Syntax Reference
- `ntpdate -d <Target_IP>` : Debug mode (reveals internal IPs).
- `ntptrace -n <Target_IP>` : Traces the hierarchy of NTP servers.
- `ntpdc -c monlist <Target_IP>` : **High Risk.** Dumps the last 600 client IPs that synced with the server.
- `ntpq -c peers <Target_IP>` : Displays a list of NTP peers the target is using.

> üìí **Note:** In modern Linux, `ntpd` is often replaced by **Chrony** (`chronyd`), which uses `chronyc` for queries.

---

## 3. NTP Enumeration Tools

| Tool | Source / URL | Capability |
| :--- | :--- | :--- |
| **PRTG Network Monitor** | [paessler.com](https://www.paessler.com) | Collects SNTP stats, response times, and sync data. |
| **Nmap (ntp-info)** | [nmap.org](https://nmap.org) | `nmap -sU -p 123 --script ntp-info <IP>` ‚Äî Pulls system info. |
| **Wireshark** | [wireshark.org](https://www.wireshark.org) | Captures NTP traffic to map client-server relationships. |
| **udp-proto-scanner** | [portcullis.co.uk](https://labs.portcullis.co.uk) | Scans for and probes common UDP services including NTP. |
| **NTP Server Scanner** | [bytefusion.com](http://www.bytefusion.com) | Specialized verification and connectivity testing for NTP. |

---

## 4. NFS Enumeration Overview

**Network File System (NFS)** allows remote file access as if it were local. It relies on **Remote Procedure Call (RPC)**.
- **Port:** **TCP/UDP 2049**.
- **RPC Link:** Uses **portmap / rpcbind** on **Port 111**.

### üõ°Ô∏è Security Model (Pre-v4)
NFS access control is primarily **IP-based**. The `/etc/exports` file on the server defines which IPs or subnets can mount specific directories.

---

## 5. NFS Enumeration Commands

Attackers use these to identify shared data and authorized clients.

### üîç rpcinfo
`rpcinfo -p <Target_IP>`
- **Usage:** Queries the portmapper to list all registered RPC services.
- **Insight:** Verifies if NFS (`2049`) and mountd are active.

### üîç showmount
`showmount -e <Target_IP>`
- **Usage:** Queries the mount daemon for exported file systems.
- **Insight:** Directly reveals shared directories and allowed client subnets.

---

## 6. NFS Enumeration Tools

Used to automate discovery and find misconfigured shares.

| Tool | Source / URL | Capability |
| :--- | :--- | :--- |
| **RPCScan** | [github.com](https://github.com/n670/rpcscan) | Communicates with RPC to check for NFS misconfigurations. |
| **SuperEnum** | [github.com](https://github.com/p3n74/superenum) | Multi-port script to perform basic enumeration on port 2049. |

---

## 7. Exploitation after NFS Enumeration

Once the directories and allowed IPs are known, the attack follows:

1. **Mounting the Share:**
   `sudo mount -t nfs <Target_IP>:/exported/path /local/mnt -o nolock`
2. **Data Browsing:** Look for configuration files, passwords, or SSH keys.
3. **Privilege Escalation:** If write access is granted, upload a web shell or a malicious cron job.
4. **IP Spoofing:** If access is restricted, spoof the IP of an authorized client to bypass the access control list (ACL).

---

## 8. CEH Exam Traps & Tips (NTP/NFS)

| ‚ö†Ô∏è Common Trap | ‚úÖ Correct Understanding |
| :--- | :--- |
| **The monlist Trap** | `ntpdc -c monlist` is a critical **information disclosure** vulnerability. |
| **NFS Dependency** | NFS is almost always tied to **RPC Port 111**. |
| **IP-Based Security** | Pre-v4 NFS security is weak because it relies solely on **IP address trust**. |
| **Stratum Levels** | `ntptrace` shows stratum levels; Stratum 1 is the primary time source. |
| **Spoofing Vulnerability** | Once an attacker knows an allowed IP (from `showmount`), they can **spoof it** to mount shares. |

---

*üìö CEH v13 ¬∑ Module 04: Enumeration | Last updated: February 2026*