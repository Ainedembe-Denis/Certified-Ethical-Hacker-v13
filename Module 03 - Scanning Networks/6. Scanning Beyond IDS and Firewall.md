# üõ°Ô∏è Scanning Beyond IDS and Firewall
### CEH v13 ¬∑ Module 03: Scanning Networks

> **About these notes:** A practical, deeply technical reference on IDS/firewall evasion ‚Äî covering advanced packet fragmentation, source routing, decoy strategies, IP/MAC spoofing, custom packet crafting with Colasoft, and an exhaustive guide to proxies, anonymizers, and censorship circumvention.

---

## üìë Table of Contents

1. [Introduction: Evading Defenses](#1-introduction-evading-defenses)
2. [IDS vs. Firewall vs. IPS ‚Äî Technical Distinctions](#2-ids-vs-firewall-vs-ips--technical-distinctions)
3. [Technique 1: Packet Fragmentation](#3-technique-1-packet-fragmentation)
4. [Technique 2: Source Routing](#4-technique-2-source-routing)
5. [Technique 3: Source Port Manipulation](#5-technique-3-source-port-manipulation)
6. [Technique 4: IP Address Decoy](#6-technique-4-ip-address-decoy)
7. [Technique 5: IP Address Spoofing](#7-technique-5-ip-address-spoofing)
8. [Technique 6: MAC Address Spoofing](#8-technique-6-mac-address-spoofing)
9. [Technique 7: Custom Packet Crafting (Colasoft Deep Dive)](#9-technique-7-custom-packet-crafting-colasoft-deep-dive)
10. [Technique 8: Idle Scan (Zombie Scan)](#10-technique-8-idle-scan-zombie-scan)
11. [Technique 9: Additional Recon Evasion Tactics](#11-technique-9-additional-recon-evasion-tactics)
12. [Anonymity & Censorship Evasion](#12-anonymity--censorship-evasion)
    - [Proxy Servers](#-proxy-servers)
    - [Anonymizers](#-anonymizers)
    - [CyberGhost, Whonix, and Tails](#-cyberghost-whonix-and-tails)
13. [Blue Team ‚Äî Detection & Countermeasures](#13-blue-team--detection--countermeasures)
14. [‚úÖ Master Key Takeaways](#-master-key-takeaways)
15. [üìã Quick Command Reference Card](#-quick-command-reference-card)
16. [‚ö†Ô∏è CEH Exam Traps & Tips](#-ceh-exam-traps--tips)

---

## 1. Introduction: Evading Defenses

Firewalls and IDS (Intrusion Detection Systems) are designed to block or alert on malicious traffic. However, attackers use **evasion techniques** to sneak past these defenses during the scanning phase by mimicking legitimate traffic or breaking attack patterns into unrecognizable pieces.

| Component | Role | Evasion Primary Goal |
|-----------|------|----------------------|
| **Firewall** | Blocks traffic based on policy | Bypass ACLs to reach "forbidden" ports |
| **IDS** | Detects suspicious patterns | Avoid triggering signature-based alerts |
| **IPS** | Blocks threats in real time | Evade detection to prevent automatic lockouts |

---

## 2. IDS vs. Firewall vs. IPS ‚Äî Technical Distinctions

Understanding the device's place in the network is vital for choosing an evasion tactic.

| Device | Action | Traffic Flow | CEH Analogy |
|--------|--------|--------------|--------------|
| **Firewall** | Block / Allow | Inline (Choke Point) | Gatekeeper |
| **IDS** | Alert / Log | Out-of-band (Mirror) | Security Camera |
| **IPS** | Block + Alert | Inline (Active) | Armed Guard |

> üéØ **Exam Tip:** If a scenario mentions "Mirroring traffic" or "SPAN ports," it's talking about a **Passive IDS**. If it mentions "dropping the connection in real time," it's an **IPS**.

---

## 3. Technique 1: Packet Fragmentation

### üìå Concept
Packet fragmentation splits probe packets into smaller pieces to confuse IDS/Firewall analysis and save defensive CPU resources (some filters skip fragmented packets for performance).

### ‚öôÔ∏è How It Works
- **SYN/FIN Scanning Over Fragments**: A specialized technique where TCP headers are split across multiple fragments. 
- **Evasion Logic**: The IDS expects a whole TCP packet to match a signature. When the SYN flag is in Fragment 1 and the Destination Port is in Fragment 2, the signature fails to match.
- **Tools**: Nmap (`-f` or `-ff`) and Zenmap.

### ‚ö†Ô∏è Risks
- **Instability**: Some target systems may crash or hang when reassembling malformed or tiny fragments.
- **Snort stream5**: Modern IDS reassemble fragments before inspection, making this mostly effective against legacy systems.

> üí° **Simply Put:**
> If you have a forbidden large item (like a ladder), you can't carry it through the gate. But if you take it apart and carry one rung at a time, the guard might not realize you're smuggling a whole ladder until it's too late.

---

## 4. Technique 2: Source Routing

### üìå Concept
Attackers dictate the exact path a packet takes through the network by manipulating the **IP Options field**.

### ‚öôÔ∏è Types
- **Loose Source Routing (LSR)**: Attacker specifies a few hops; routers choose the rest.
- **Strict Source Routing (SSR)**: Attacker specifies every single hop in the path.

### üõ°Ô∏è Use Case
If a firewall is configured to "Trust traffic from Node B," but blocks traffic from "Attacker Node A," Node A can source-route the packet *through* Node B to reach the target victim.
- **Example**: Firewall allows manipulated port 80 traffic to the victim if it appears to come from a specific routed path.

> üí° **Simply Put:**
> GPS usually tells you the shortest path. Source Routing is like telling the delivery driver: "Don't take the highway; go through the back alley where the security guard is asleep."

---

## 5. Technique 3: Source Port Manipulation

### üìå Concept
Firewalls often allow traffic from **well-known ports** (HTTP 80, DNS 53, FTP 21) without deep inspection. Attackers disguise their scanners by setting their source port to these trusted values.

### üõ†Ô∏è Nmap/Zenmap Usage
- **Command**: `-g` or `--source-port`.
- **Logic**: Scanning over a firewall using Zenmap with source port 53 can bypass rules that allow DNS queries.

| Port | Service | Why It Bypasses Rules |
|:----:|---------|-----------------------|
| 53 | DNS | Whitelisted for lookups |
| 80 | HTTP | Allowed for web traffic |
| 21 | FTP | Allowed for file transfers |

---

## 6. Technique 4: IP Address Decoy

### üìå Concept
Attackers mix their real IP with multiple fake IPs (**decoys**) to hide in a crowd of scanning traffic.

### üõ†Ô∏è Nmap Commands
- **Random Decoys**: `nmap -D RND:10 [target]`
- **Manual Decoy List**: `nmap -D decoy1,decoy2,ME,decoy3 [target]`

> üí° **Simply Put:**
> It's like wearing the same outfit as 10 other people while you spray-paint a wall. When the police arrive, they see 11 "identical" suspects and don't know who to chase first.

### üìä Syntax Example (CEH Documented)
Assume **10.10.1.19** is the real attacker and **10.10.1.11** is the target:
```bash
# nmap -D 192.168.0.1,172.120.2.8,192.168.2.8,10.10.1.19,10.10.1.5 10.10.1.11
```
> ÔøΩ The `ME` keyword or placing your real IP in the list ensures you get the results while decoys draw the fire of defenders.

---

## 7. Technique 5: IP Address Spoofing

### üìå Concept
The attacker forge the Source IP address in packet headers to appear as a different host.

### üõ†Ô∏è Tool: Hping3
```bash
# Spoof source as 7.7.7.7 to target www.certifiedhacker.com
hping3 www.certifiedhacker.com -a 7.7.7.7
```

### ‚ö†Ô∏è Limitations
- **No Handshake**: Cannot establish a real TCP connection because the target's SYN-ACK goes to the spoofed host, not the attacker.
- **Usage**: Used for DoS reflection or scanning where only a one-way probe is needed.

---

## 8. Technique 6: MAC Address Spoofing

### üìå Concept
Bypassing MAC-based filters (ACLs) on switches or firewalls by faking a trusted hardware address.

### üõ†Ô∏è Nmap Options
```bash
# Random MAC (generates a completely new identity)
nmap -sT -Pn --spoof-mac 0 [Target IP]

# Vendor-specific MAC (e.g., Apple, Cisco)
nmap -sT -Pn --spoof-mac [Vendor] [Target IP]

# Specific Manual MAC
nmap -sT -Pn --spoof-mac [new MAC] [Target IP]
```

---

## 9. Technique 7: Custom Packet Crafting (Colasoft Deep Dive)

### üìå Concept
Attackers use advanced tools to build packet streams with custom flags, transfer rates, and protocols to bypass specific firewall logic.

### üõ†Ô∏è Tool: Colasoft Packet Builder
**Source**: [https://www.colasoft.com](https://www.colasoft.com)

| View | Purpose |
|------|---------|
| **Packet List** | Displays all constructed packets; allows selection for editing |
| **Decode Editor** | Edit packets logically (change values in boxes) without needing to know offsets/lengths |
| **Hex Editor** | Edit raw hexadecimal or ASCII characters directly |

### ‚öôÔ∏è Key Features
- **Creating Packets**: Use "Add" or "Insert" command in the Edit menu.
- **Sending Controls**: Specify interval between packets, loop times, and delay between loops.
- **Attack Potential**: Attackers use this to create fragmented packets for evasion or flood targets for **DoS attacks**.

> üí° **Related Tool**: **NetScanTools Pro** ([https://www.netscantools.com](https://www.netscantools.com)) is another major packet-crafting suite for defenders and attackers.

---

## 10. Technique 8: Idle Scan (Zombie Scan)

The most stealthy method. The attacker uses a third-party host (**Zombie**) with a predictable IP ID sequence. The target only sees the Zombie's IP.

---

## 11. Technique 9: Additional Recon Evasion Tactics

### üîπ Randomizing Host Order
- **Logic**: Scanning targets in random order prevents traditional IDS from detecting a "sequential sweep" (e.g., scanning 1, then 2, then 3).
- **Tool**: Nmap `--randomize-hosts` (or Zenmap checkboxes).

### üîπ Sending Bad Checksums
- **Logic**: Use the `--badsum` flag in Nmap. 
- **Forensic Deduction**:
    - **Get a response?** ‚Üí The IDS or Firewall failed to verify the checksum (improperly configured).
    - **No response?** ‚Üí The system is well-configured and dropped the garbage packet.

---

## 12. Anonymity & Censorship Evasion

### üåê Proxy Servers

A **proxy server** is an application that serves as an intermediary between a client and a destination server. It intercepts requests and communicates with the target on your behalf.

#### ‚öôÔ∏è How a Proxy Server Works
1. **Request**: The client sends a request for a web page to the proxy server.
2. **Mediation**: The proxy server receives the request and sends it to the actual server on the client's behalf.
3. **Response**: The actual server responds to the proxy.
4. **Relay**: The proxy server transmits the response back to the client.

#### üõ†Ô∏è Key Use Cases for Proxies
| Use Case | Technical Benefit |
|----------|-------------------|
| **Firewall & Protection** | Acts as a shield, protecting the local network from external attacks |
| **IP Multiplexer (NAT/PAT)** | Allows multiple computers to connect to the Internet using a single public IP |
| **Anonymization** | Masks the client's real IP address during browsing |
| **Content Filtering** | Extracts unwanted content (ads) or blocks unsuitable material |
| **Hacking Defense** | Provides a layer of protection against direct hacking attempts |
| **Bandwidth Saving** | Caches frequently accessed content to reduce load times |

#### üòà Why Attackers Use Proxy Servers
1. **Hide Actual Source**: Mask the source IP of a scan to evade IDS/Firewall rules.
2. **Avoid Legal Consequences**: Hide the source IP so malicious activities cannot be easily traced back to them.
3. **Mask Attack Source**: Use a fake source address (the proxy) to hide the real attack origin.
4. **Access Restricted Resources**: Remotely access intranets or restricted website resources.
5. **Intercept Requests**: Interrupt user requests and transmit them to a third destination host.
6. **Evasion**: Access blocked sites and bypass organizational firewall restrictions anonymously.

#### ‚õìÔ∏è Proxy Chaining
Proxy chaining increases anonymity by routing traffic through multiple proxies sequentially.
1. **Request**: User requests a resource.
2. **Connection**: A proxy client connects to the first proxy server.
3. **Stripping**: The proxy server strips the user's identification info and passes the request to the next proxy.
4. **Repetition**: Each proxy in the chain repeats the stripping and forwarding process.
5. **Final Delivery**: The final unencrypted request is passed to the web server.

> üí° **Simply Put:**
> Imagine telling a secret to Friend A, who tells Friend B, who tells Friend C, who then yells it in public. The public only knows Friend C said it, and Friend C only knows Friend B told them. No one knows it started with you.

#### üõ†Ô∏è Comprehensive Proxy Toolset
| Tool | Source | Use Case |
|------|--------|----------|
| **Proxy Switcher** | [proxyswitcher.com](https://www.proxyswitcher.com) | Quickly switches between proxies for anonymous browsing and ban evasion |
| **CyberGhost VPN** | [cyberghostvpn.com](https://www.cyberghostvpn.com) | Hides IP, encrypts connection, and maintains no logs for privacy |
| **Burp Suite** | [portswigger.net](https://www.portswigger.net) | Intercepting proxy for web application security testing |
| **Tor** | [torproject.org](https://www.torproject.org) | Distributed network of relays for high-level anonymity |
| **Hotspot Shield** | [hotspotshield.com](https://www.hotspotshield.com) | VPN for secure and anonymous web surfing |
| **Proxifier** | [proxifier.com](https://www.proxifier.com) | Allows network apps that don't support proxies to operate through a SOCKS/HTTP proxy |
| **IPRoyal** | [iproyal.com](https://iproyal.com) | Provides residential proxies to avoid detection and bot-blocking |

---

### üõ°Ô∏è Anonymizers

An **anonymizer** is an intermediate server that intercepts a user's web request to make their surfing activities untraceable. It encrypts data and eliminates identifying information (like your IP) before passing the request to the target site.

#### üí° Why Use an Anonymizer?
- **Ensuring Privacy**: Makes navigation activities untraceable unless personal info is voluntarily submitted via forms.
- **Accessing Government-Restricted Content**: Bypasses geographical or political censorship by routing through a server in a different country.
- **Protection Against Online Attacks**: Routes traffic via protected DNS servers to prevent pharming attacks.
- **Bypassing IDS/Firewall Rules**: Organization firewalls only see a connection to the anonymizer's address, not the final (often restricted) site like Twitter or GitHub.

#### üìä Types of Anonymizers
| Type | Description | Pros & Cons |
|------|-------------|-------------|
| **Networked** | Transfers info through a network of Internet-connected computers (e.g., Tor) before the destination. | ‚úÖ Complicates traffic analysis. ‚ùå Risk of compromise at individual nodes. |
| **Single-Point** | Transfers info through a single website intermediary. | ‚úÖ Hides IP via "arms-length" communication. ‚ùå Vulnerable to sophisticated traffic analysis. |

#### üè† Specialized Anonymity Platforms
- **Whonix**: [whonix.org](https://www.whonix.org) ‚Äî A security-focused desktop OS consisting of multiple virtual machines. It ensures fail-safe, automatic, and system-wide use of the Tor network to prevent IP leaks.
- **Tails**: [tails.net](https://tails.net) ‚Äî A Live OS that runs from a USB or SD card. It uses cryptographic tools to encrypt all communications and leaves **zero trace** on the target computer after shutdown.
- **AstrillVPN**: [astrill.com](https://www.astrill.com) ‚Äî VPN software designed to bypass aggressive censorship. It avoids logging DNS queries and traffic metadata to prevent tracking.
- **I2P**: [geti2p.net](https://geti2p.net) ‚Äî The "Invisible Internet Project," a decentralized anonymous network layer for peer-to-peer communication.
- **Psiphon**: [psiphon.ca](https://psiphon.ca) ‚Äî A censorship circumvention tool using a combination of VPN, SSH, and HTTP proxy technologies.

---

## 13. Blue Team ‚Äî Detection & Countermeasures

- **Snort stream5**: Reassembles fragments to catch fragmentation attacks.
- **Ingress/Egress Filtering**: Blocks spoofed packets at the network edge.
- **Stateful Inspection**: Prevents source port manipulation by tracking connection history.

---

## 14. ‚úÖ Master Key Takeaways

1. **Fragmentation & Decoys** add "noise" to hide the attacker.
2. **IP Spoofing** is best for DoS, not for full TCP scanning.
3. **Proxies** mask your source IP in server logs.
4. **Packet Crafting** (Colasoft) allows for custom evasion signatures and DoS.
5. **Bad Checksums** test whether a firewall is actually checking data integrity.

---

## 15. üìã Quick Command Reference Card

| Goal | Tool / Command |
|------|----------------|
| Fragment Scanning | `nmap -f <target>` |
| Hide in Decoys | `nmap -D 1.1.1.1,2.2.2.2,ME <target>` |
| MAC Spoofing | `nmap --spoof-mac 0 <target>` |
| IP Spoofing | `hping3 <target> -a <spoofed_IP>` |
| Bad Checksums | `nmap --badsum <target>` |
| Use Proxy | `proxychains nmap -sT <target>` |

---

## 16. ‚ö†Ô∏è CEH Exam Traps & Tips

- **Trap**: "Which technique establishing a connection while hiding its source?" ‚Üí **Idle Scan** (Proxy servers also mediate).
- **Tip**: Remember **Colasoft Packet Builder's three views**: Packet List, Decode Editor, and Hex Editor.
- **Tip**: **Standardization** ‚Äî Anonymizers ensure privacy until you voluntarily disclose info on a form.
- **Tip**: **SSR vs LSR** ‚Äî Strict Source Routing (SSR) means *every* hop is defined.

---

*üìö CEH v13 ¬∑ Module 03: Scanning Networks | Last updated: February 2026*